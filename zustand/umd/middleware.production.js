!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).zustandMiddleware={})}(this,(function(t){"use strict";function e(){return e=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},e.apply(this,arguments)}var n=function(t,e){var n;try{n=JSON.parse(t)}catch(t){console.error("[zustand devtools middleware] Could not parse the received json",t)}void 0!==n&&e(n)},r=function t(e){return function(n){try{var r=e(n);return r instanceof Promise?r:{then:function(e){return t(e)(r)},catch:function(t){return this}}}catch(e){return{then:function(t){return this},catch:function(n){return t(n)(e)}}}}};t.combine=function(t,e){return function(n,r,i){return Object.assign({},t,e(n,r,i))}},t.devtools=function(t,e){return function(r,i,o){var a,u=void 0===e?{}:"string"==typeof e?{name:e}:e;try{a=window.__REDUX_DEVTOOLS_EXTENSION__}catch(t){}if(!a)return t(r,i,o);var c=a.connect(u),s=!0;o.setState=function(t,e,n){r(t,e),s&&c.send(void 0===n?{type:u.anonymousActionType||"anonymous"}:"string"==typeof n?{type:n}:n,i())};var f=function(){var t=s;s=!1,r.apply(void 0,arguments),s=t},d=t(o.setState,i,o);if(c.init(d),o.dispatchFromDevtools&&"function"==typeof o.dispatch){var l=!1,p=o.dispatch;o.dispatch=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];"__setState"!==e[0].type||l||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),l=!0),p.apply(void 0,e)}}return c.subscribe((function(t){switch(t.type){case"ACTION":return"string"!=typeof t.payload?void console.error("[zustand devtools middleware] Unsupported action format"):n(t.payload,(function(t){"__setState"!==t.type?o.dispatchFromDevtools&&"function"==typeof o.dispatch&&o.dispatch(t):f(t.state)}));case"DISPATCH":switch(t.payload.type){case"RESET":return f(d),c.init(o.getState());case"COMMIT":return c.init(o.getState());case"ROLLBACK":return n(t.state,(function(t){f(t),c.init(o.getState())}));case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return n(t.state,(function(t){f(t)}));case"IMPORT_STATE":var e,r=t.payload.nextLiftedState,i=null==(e=r.computedStates.slice(-1)[0])?void 0:e.state;if(!i)return;return f(i),void c.send(null,r);case"PAUSE_RECORDING":return s=!s}return}})),d}},t.persist=function(t,n){return function(i,o,a){var u,c=e({getStorage:function(){return localStorage},serialize:JSON.stringify,deserialize:JSON.parse,partialize:function(t){return t},version:0,merge:function(t,n){return e({},n,t)}},n),s=!1,f=new Set,d=new Set;try{u=c.getStorage()}catch(t){}if(!u)return t((function(){console.warn("[zustand persist middleware] Unable to update item '"+c.name+"', the given storage is currently unavailable."),i.apply(void 0,arguments)}),o,a);var l=r(c.serialize),p=function(){var t,n=c.partialize(e({},o())),r=l({state:n,version:c.version}).then((function(t){return u.setItem(c.name,t)})).catch((function(e){t=e}));if(t)throw t;return r},v=a.setState;a.setState=function(t,e){v(t,e),p()};var h,y=t((function(){i.apply(void 0,arguments),p()}),o,a),g=function(){if(u){s=!1,f.forEach((function(t){return t(o())}));var t=(null==c.onRehydrateStorage?void 0:c.onRehydrateStorage(o()))||void 0;return r(u.getItem.bind(u))(c.name).then((function(t){if(t)return c.deserialize(t)})).then((function(t){if(t){if("number"!=typeof t.version||t.version===c.version)return t.state;if(c.migrate)return c.migrate(t.state,t.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}})).then((function(t){return h=c.merge(t,y),i(h,!0),p()})).then((function(){null==t||t(h,void 0),s=!0,d.forEach((function(t){return t(h)}))})).catch((function(e){null==t||t(void 0,e)}))}};return a.persist={setOptions:function(t){c=e({},c,t),t.getStorage&&(u=t.getStorage())},clearStorage:function(){var t;null==(t=u)||t.removeItem(c.name)},rehydrate:function(){return g()},hasHydrated:function(){return s},onHydrate:function(t){return f.add(t),function(){f.delete(t)}},onFinishHydration:function(t){return d.add(t),function(){d.delete(t)}}},g(),h||y}},t.redux=function(t,n){return function(r,i,o){return o.dispatch=function(e){return r((function(n){return t(n,e)}),!1,e),e},o.dispatchFromDevtools=!0,e({dispatch:function(){return o.dispatch.apply(o,arguments)}},n)}},t.subscribeWithSelector=function(t){return function(e,n,r){var i=r.subscribe;return r.subscribe=function(t,e,n){var o=t;if(e){var a=(null==n?void 0:n.equalityFn)||Object.is,u=t(r.getState());o=function(n){var r=t(n);if(!a(u,r)){var i=u;e(u=r,i)}},null!=n&&n.fireImmediately&&e(u,u)}return i(o)},t(e,n,r)}},Object.defineProperty(t,"__esModule",{value:!0})}));
